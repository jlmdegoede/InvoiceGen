{% extends 'base.html' %}
{% load staticfiles %}

{% block title %}
    FactuurMaker
{% endblock %}

{% block header %}
{% endblock %}

{% block content %}

<h2>Overeenkomst van {{ agreement.created|date:"d-m-Y" }} met {{ agreement.client_name }}</h2>

<h4>Over</h4>
<ul>
{% for article in agreement.article_concerned.all %}
    <li>{{ article.title }} / {{ article.world_count }} / {{ article.date_deadline }}</li>
{% endfor %}
</ul>

Contactpersoon: {{ agreement.client_name }}

<h4>Overeenkomst</h4>
<style>
.small  {height:300px;overflow:hidden;}
.big    {height: auto;}
</style>

<div id="agreement" class="wrapper">
    <a href="#">Uitklappen</a>
    <div class="small">
    {{ agreement.agreement_text_copy | linebreaks }}
        </div>
</div>

<script type="text/javascript">
    $(document).ready(function() {
       $('.wrapper').find('a[href="#"]').on('click', function (e) {
            e.preventDefault();
            this.expand = !this.expand;
            $(this).text(this.expand?"Inklappen":"Uitklappen");
            $(this).closest('.wrapper').find('.small, .big').toggleClass('small big');
        });
    });
</script>

    <div style="clear:both;"><br /></div>

    <h4>Ondertekenen</h4>

    {%  if error %}
        <div class="card-panel red">
            <span>{{ error }}</span>
        </div>
    {% endif %}
{% if not agreement.signed_by_client %}
Indien akkoord, voer hieronder uw e-mailadres in en letterlijk de tekst 'Ik ga akkoord'  zonder aanhalingstekens.

<form action="/agreements/view-sign-agreement/{{ agreement.url }}" method="post">
    {% csrf_token %}
    <input type="text" name="emailaddress" placeholder="Uw e-mailadres" required />
    <input type="text" name="agreed" placeholder="Akkoordfrase" required />
    <input type="submit" name="submit" class="btn waves-effect waves-light" /><i class="material-icons right">send</i>
</form>

{% else %}
    Deze overeenkomst is ondertekend door {{ agreement.client_emailaddress }} op tijdstip {{ agreement.signed_by_client_at }} en door
    de opdrachtnemer op {{ agreement.signed_by_contractor_at }}.
{% endif %}

{% endblock %}